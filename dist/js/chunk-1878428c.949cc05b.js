(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1878428c"],{"1df4":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Row",[a("Col",{attrs:{span:"6"}},[a("Card",[a("p",{attrs:{slot:"title"},slot:"title"},[a("Icon",{attrs:{type:"ios-redo"}}),t._v("\n          选择数据库\n        ")],1),a("div",{staticClass:"edittable-test-con"},[a("Form",{ref:"formItem",attrs:{model:t.formItem,"label-width":100,rules:t.ruleValidate}},[a("Form-item",{attrs:{label:"环境:",prop:"idc"}},[a("Select",{attrs:{placeholder:"请选择"},on:{"on-change":t.fetchSource},model:{value:t.formItem.idc,callback:function(e){t.$set(t.formItem,"idc",e)},expression:"formItem.idc"}},t._l(t.fetchData.idc,function(e){return a("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])}),1)],1),a("Form-item",{attrs:{label:"连接名称:",prop:"source"}},[a("Select",{attrs:{placeholder:"请选择"},on:{"on-change":t.fetchBase},model:{value:t.formItem.source,callback:function(e){t.$set(t.formItem,"source",e)},expression:"formItem.source"}},t._l(t.fetchData.source,function(e){return a("Option",{key:e,attrs:{value:e}},[t._v(t._s(e)+"\n                ")])}),1)],1),a("Form-item",{attrs:{label:"数据库库名:",prop:"database"}},[a("Select",{attrs:{placeholder:"请选择"},on:{"on-change":t.fetchTable},model:{value:t.formItem.database,callback:function(e){t.$set(t.formItem,"database",e)},expression:"formItem.database"}},t._l(t.fetchData.base,function(e){return a("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])}),1)],1),a("Form-item",{attrs:{label:"数据库表名:"}},[a("Select",{attrs:{placeholder:"请选择"},model:{value:t.formItem.table,callback:function(e){t.$set(t.formItem,"table",e)},expression:"formItem.table"}},t._l(t.fetchData.table,function(e){return a("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])}),1)],1),a("Form-item",[a("Button",{attrs:{type:"primary"},on:{click:function(e){return t.fetchStruct()}}},[t._v("获取表结构信息")]),a("Button",{staticClass:"margin-left-10",attrs:{type:"error"},on:{click:function(e){return t.clearForm()}}},[t._v("重置")])],1),a("FormItem",{attrs:{label:"工单提交说明:",prop:"text"}},[a("Input",{attrs:{placeholder:"请输入工单说明",type:"textarea",rows:4},model:{value:t.formItem.text,callback:function(e){t.$set(t.formItem,"text",e)},expression:"formItem.text"}})],1),a("FormItem",{attrs:{label:"审核人:",prop:"assigned"}},[a("Select",{attrs:{transfer:""},model:{value:t.formItem.assigned,callback:function(e){t.$set(t.formItem,"assigned",e)},expression:"formItem.assigned"}},t._l(t.fetchData.assigned,function(e){return a("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])}),1)],1),a("FormItem",{attrs:{label:"定时执行"}},[a("DatePicker",{attrs:{format:"yyyy-MM-dd HH:mm",type:"datetime",placeholder:"选择时间点",options:t.invalidDate,editable:!1},on:{"on-change":function(e){t.formItem.delay=e}},model:{value:t.formItem.delay,callback:function(e){t.$set(t.formItem,"delay",e)},expression:"formItem.delay"}})],1),a("FormItem",{attrs:{label:"是否备份",prop:"backup"}},[a("RadioGroup",{model:{value:t.formItem.backup,callback:function(e){t.$set(t.formItem,"backup",e)},expression:"formItem.backup"}},[a("Radio",{attrs:{label:1}},[t._v("是")]),a("Radio",{attrs:{label:0}},[t._v("否")])],1)],1)],1)],1)])],1),a("Col",{staticClass:"padding-left-10",attrs:{span:"18"}},[a("Card",[a("p",{attrs:{slot:"title"},slot:"title"},[a("Icon",{attrs:{type:"md-remove"}}),t._v("\n          填写SQL语句\n        ")],1),a("div",{staticClass:"edittable-table-height-con"},[a("Tabs",{attrs:{value:t.tabs}},[a("TabPane",{attrs:{label:"填写SQL语句",name:"order1",icon:"md-code"}},[a("Form",[a("FormItem",[a("editor",{on:{init:t.editorInit,setCompletions:t.setCompletions},model:{value:t.formDynamic,callback:function(e){t.formDynamic=e},expression:"formDynamic"}})],1),a("FormItem",[a("Table",{attrs:{columns:t.testColumns,data:t.testResults,"highlight-row":""}})],1),a("FormItem",[a("Button",{attrs:{type:"primary",loading:t.loading},on:{click:t.testSql}},[t._v("检测语句")]),a("Button",{staticClass:"margin-left-10",attrs:{type:"info",loading:t.loading},on:{click:t.merge}},[t._v("ALTER语句合并")]),a("Button",{staticClass:"margin-left-10",attrs:{type:"warning",loading:t.loading},on:{click:t.beauty}},[t._v("美化")]),a("Button",{staticClass:"margin-left-10",attrs:{type:"success",disabled:t.validate_gen},on:{click:t.commitOrder}},[t._v("提交工单\n                  ")])],1)],1)],1),a("TabPane",{attrs:{label:"表结构详情",name:"order2",icon:"md-folder"}},[a("Table",{attrs:{columns:t.fieldColumns,data:t.fieldData}})],1),a("TabPane",{attrs:{label:"索引详情",name:"order3",icon:"md-folder"}},[a("Table",{attrs:{columns:t.idxColums,data:t.idxData}})],1)],1)],1)])],1)],1)],1)},n=[],r=(a("ac4d"),a("8a81"),a("28a5"),a("ac6a"),a("bc3a")),i=a.n(r),l=a("a897"),c=a("efd9"),s={components:{editor:l["a"]},mixins:[c["a"],c["c"]],data:function(){return{formItem:{text:"",idc:"",source:"",database:"",table:"",backup:1,assigned:"",delay:null},tabs:"order1",formDynamic:"",validate_gen:!0,wordList:[],testResults:[],fieldColumns:[{title:"字段名",key:"Field"},{title:"字段类型",key:"Type",editable:!0},{title:"字段是否为空",key:"Null",editable:!0,option:!0},{title:"默认值",key:"Default",editable:!0},{title:"备注",key:"Comment"}],fieldData:[],idxColums:[{title:"索引名称",key:"IndexName"},{title:"是否唯一索引",key:"NonUnique"},{title:"字段名",key:"ColumnName"}],idxData:[],loading:!1}},methods:{fetchSource:function(t){var e=this;t&&i.a.get("".concat(this.$config.url,"/fetch/source/").concat(t,"/ddl")).then(function(t){"ddl"===t.data.x?(e.fetchData.source=t.data.source,e.fetchData.assigned=t.data.assigned):e.$config.notice("非法劫持参数！")}).catch(function(t){e.$config.err_notice(e,t)})},merge:function(){var t=this;i.a.put("".concat(this.$config.url,"/query/merge"),{sql:this.formDynamic}).then(function(e){e.data.e?t.$config.notice(e.err):t.formDynamic=e.data.sols}).catch(function(e){return t.$config.err_notice(t,e)})},beauty:function(){var t=this;i.a.put("".concat(this.$config.url,"/query/beauty"),{sql:this.formDynamic}).then(function(e){t.formDynamic=e.data}).catch(function(e){return t.$config.err_notice(t,e)})},fetchStruct:function(){var t=this;this.$refs["formItem"].validate(function(e){e?(t.$Spin.show({render:function(t){return t("div",[t("Icon",{props:{size:30,type:"ios-loading"},style:{animation:"ani-demo-spin 1s linear infinite"}}),t("div","数据库连接中,请稍后........")])}}),i.a.put("".concat(t.$config.url,"/fetch/tableinfo"),{source:t.formItem.source,base:t.formItem.database,table:t.formItem.table}).then(function(e){t.fieldData=e.data.f,t.idxData=e.data.i,t.$Spin.hide()}).catch(function(){t.$config.err_notice(t,"连接失败！详细信息请查看日志"),t.$Spin.hide()})):t.$Message.error("表单验证失败!")})},testSql:function(){var t=this;this.$refs["formItem"].validate(function(e){e?(t.loading=!0,i.a.put("".concat(t.$config.url,"/fetch/test"),{source:t.formItem.source,database:t.formItem.database,table:t.formItem.table,sql:t.formDynamic,isDMl:!1}).then(function(e){t.testResults=e.data;var a=0;t.testResults.forEach(function(t){0!==t.Level&&(a+=1)}),t.validate_gen=0!==a,t.loading=!1}).catch(function(e){t.loading=!1,t.$config.err_notice(t,e)})):t.$Message.error("请填写具体地址或sql语句后再测试!")})},commitOrder:function(){var t=this;this.$refs["formItem"].validate(function(e){e&&i.a.post("".concat(t.$config.url,"/sql/refer"),{ddl:t.formItem,sql:t.formDynamic,ty:0}).then(function(e){t.validate_gen=!0,t.$Notice.success({title:"成功",desc:e.data})}).catch(function(e){t.validate_gen=!0,t.$config.err_notice(t,e)})})}},mounted:function(){var t=!0,e=!1,a=void 0;try{for(var o,n=this.$config.highlight.split("|")[Symbol.iterator]();!(t=(o=n.next()).done);t=!0){var r=o.value;this.wordList.push({vl:r,meta:"关键字"})}}catch(i){e=!0,a=i}finally{try{t||null==n.return||n.return()}finally{if(e)throw a}}this.fetchIDC()}},m=s,f=(a("c6f7"),a("2877")),d=Object(f["a"])(m,o,n,!1,null,"0e0ea533",null);e["default"]=d.exports},c6f7:function(t,e,a){"use strict";var o=a("faf3"),n=a.n(o);n.a},faf3:function(t,e,a){}}]);
//# sourceMappingURL=chunk-1878428c.949cc05b.js.map