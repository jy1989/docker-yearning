(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d300c27"],{"063d":function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("Row",[r("Card",[r("p",{staticStyle:{height:"45px"},attrs:{slot:"title"},slot:"title"},[r("Icon",{attrs:{type:"android-send"}}),t._v("\n                工单"+t._s(this.$route.query.workid)+"详细信息\n                "),r("br"),1===this.$route.query.status?r("Button",{attrs:{type:"text"},nativeOn:{click:function(e){return t.rollback()}}},[t._v("查看回滚语句")]):0===this.$route.query.status||4===this.$route.query.status?r("Button",{attrs:{type:"text"},nativeOn:{click:function(e){return t.repairOrder()}}},[t._v("重新提交\n                ")]):t._e(),r("Button",{attrs:{type:"text"},nativeOn:{click:function(e){return t.$router.go(-1)}}},[t._v("返回")])],1),r("Row",[r("Col",{attrs:{span:"24"}},[r("Table",{staticClass:"tabletop",staticStyle:{background:"#5cadff"},attrs:{border:"",columns:t.tabcolumns,data:t.TableDataNew,size:"large"}}),r("br"),r("Page",{ref:"page",attrs:{total:t.page_number,"show-elevator":"","page-size":20},on:{"on-change":t.currentpage}})],1)],1)],1)],1),r("BackTop",{attrs:{height:100,bottom:200}},[r("div",{staticClass:"top"},[t._v("返回顶端")])]),r("Modal",{attrs:{"ok-text":"提交工单",width:"800"},on:{"on-ok":t.referOrder},model:{value:t.reloadsql,callback:function(e){t.reloadsql=e},expression:"reloadsql"}},[r("Row",[r("Card",[r("div",{staticClass:"step-header-con"},[r("h3",[t._v("Yearning SQL平台审核工单")])]),r("p",{staticClass:"step-content"}),r("Form",{staticClass:"step-form"},[r("FormItem",{attrs:{label:"用户名:"}},[r("p",[t._v(t._s(t.formItem.Username))])]),r("FormItem",{attrs:{label:"环境:"}},[r("p",[t._v(t._s(t.formItem.IDC))])]),r("FormItem",{attrs:{label:"连接名:"}},[r("p",[t._v(t._s(t.formItem.Source))])]),r("FormItem",{attrs:{label:"数据库库名:"}},[r("p",[t._v(t._s(t.formItem.DataBase))])]),r("FormItem",{attrs:{label:"定时执行:"}},[r("p",[t._v(t._s(t.formItem.Delay))])]),r("FormItem",[0===this.$route.query.status||4===this.$route.query.status?r("Input",{attrs:{type:"textarea"},model:{value:t.formItem.SQL,callback:function(e){t.$set(t.formItem,"SQL",e)},expression:"formItem.SQL"}}):t._e(),1===this.$route.query.status?r("Table",{attrs:{columns:t.rollColumn,data:t.rollData,"max-height":"300"}}):t._e()],1),r("FormItem",{attrs:{label:"工单提交说明:"}},[r("Input",{attrs:{placeholder:"最多不超过20个字"},model:{value:t.formItem.text,callback:function(e){t.$set(t.formItem,"text",e)},expression:"formItem.text"}})],1),r("FormItem",{attrs:{label:"是否备份"}},[r("RadioGroup",{model:{value:t.formItem.Backup,callback:function(e){t.$set(t.formItem,"Backup",e)},expression:"formItem.Backup"}},[r("Radio",{attrs:{label:1}},[t._v("是")]),r("Radio",{attrs:{label:0}},[t._v("否")])],1)],1)],1)],1)],1)],1)],1)},o=[],n=(r("ac6a"),r("bc3a")),s=r.n(n),c=r("c622"),l={name:"myorder-list",data:function(){return{page_number:1,tabcolumns:[{title:"sql语句",key:"SQL"},{title:"状态",key:"State"},{title:"错误信息",key:"Error",tooltip:!0},{title:"影响行数",key:"Affectrow",width:100},{title:"执行时间/秒",key:"Time"}],TableDataNew:[],single:!1,reloadsql:!1,formItem:{},rollColumn:[{type:"expand",width:50,render:function(t,e){return t(c["a"],{props:{row:e.row}})}},{title:"当前检查的sql",key:"SQL",render:function(t,e){var r=e.row.SQL.substring(0,80)+"...";return t("span",r)}}],rollData:[]}},methods:{rollback:function(){var t=this;s.a.get("".concat(this.$config.url,"/fetch/roll?workid=").concat(this.$route.query.workid)).then(function(e){e.data.sql!==[]?(t.reloadsql=!0,t.formItem=e.data.order,t.rollData=e.data.sql,t.formItem.Delay="none"):t.$config.err_notice(t,"此工单没有备份或语句执行失败!")}).catch(function(e){t.$config.err_notice(t,e)})},repairOrder:function(){var t=this;s.a.get("".concat(this.$config.url,"/fetch/roll?workid=").concat(this.$route.query.workid)).then(function(e){t.formItem=e.data.order,t.formItem.Delay="none"}).catch(function(e){t.$config.err_notice(t,e)}),this.reloadsql=!0},referOrder:function(){var t=this;if(1===this.$route.query.status){var e="";this.rollData.forEach(function(t){e+=t.SQL}),this.formItem.SQL=e}delete this.formItem.ID,s.a.post("".concat(this.$config.url,"/fetch/rollorder"),{data:this.formItem}).then(function(){t.$config.notice("工单已提交成功")}).catch(function(e){t.$config.err_notice(t,e)})},currentpage:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;s.a.get("".concat(this.$config.url,"/fetch/detail?workid=").concat(this.$route.query.workid,"&status=").concat(this.$route.query.status,"&page=").concat(e)).then(function(e){t.TableDataNew=e.data.record,t.page_number=e.data.count}).catch(function(e){t.$config.err_notice(t,e)})}},mounted:function(){this.currentpage()}},i=l,u=(r("8f88"),r("2877")),m=Object(u["a"])(i,a,o,!1,null,null,null);e["default"]=m.exports},"8f88":function(t,e,r){"use strict";var a=r("aeba"),o=r.n(a);o.a},aeba:function(t,e,r){},c622:function(t,e,r){"use strict";var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("Row",[r("Col",[r("code",[t._v(t._s(t.row.SQL))])])],1)},o=[],n={name:"expandTable",props:{row:Object}},s=n,c=r("2877"),l=Object(c["a"])(s,a,o,!1,null,"564f6147",null);e["a"]=l.exports}}]);
//# sourceMappingURL=chunk-2d300c27.10dcc624.js.map